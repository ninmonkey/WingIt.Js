<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WingIt.Js - Basic Movement</title>
    <link rel="stylesheet" href="./css/main.css" type="text/css">
</head>

<body>
    <!-- <section>
        <nav>
            <ul>
                <li><a href="./">Go Back</a></li>
                <li><a href="#" id="cmd-btn-toggle-grid-large">Large / Small</a></li>
            </ul>
        </nav>
    </section> -->
    <h1>Basic Movement</h1>
    <section class="canvas-parent parent-context grid-small">

        <canvas id="canvas" width="800px" height="600px"></canvas>

    </section>

    <script type="module">
        import { randomInt, randomNumber, toDegrees, toRadians } from './../../js/utils.js';
        import { Boid, Vector2, WrapScreenEdge } from './../../js/boid.js';
        // import { labelPoint } from './../../js/drawing.js';
        // globals
        window.bag ??= {}
        window.toDeg = toDegrees
        window.toRad = toRadians

        let entityList = Array.from( [] )


        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const color_clear_canvas = "#464746";
        const color_boid_fill = "rgb(27, 151, 182)";

        function drawCanvas( )  {
            // first clear all
            ctx.clearRect(0, 0, screen.width, screen.height)

            for( const ent of entityList ) {
                ent.draw( ctx )
            }
        }
        let start

        function updateGameStep( timestamp ) {
            if (start === undefined) {
                start = timestamp;
            }
            const elapsed = timestamp - start;

            // from:    Math.min() is used here to make sure the element stops at exactly 200px
            //    const shift = Math.min(0.1 * elapsed, 200);
            //    bird.Position.x = shift
            //    element.style.transform = `translateX(${shift}px)`;
            //    if (shift > 200) {
            //        bird.Velocity.x = bird.Velocity.x * -2
            //        // bird.Velocity.y = 0
            //     }

            for( const ent of entityList ) {
                ent.Position.x += ent.Velocity.x
                ent.Position.y += ent.Velocity.y

                WrapScreenEdge( ent, canvas )
            }

            // WrapScreenEdge( bird )
            drawCanvas( )

            // console.info(timestamp)

            requestAnimationFrame(updateGameStep)
        }
        function InitializePage() {
            // updateGameStep()
            let i
            for( i = 0; i < 13; i++ ) {
                const b = new Boid()
                b.Position.x = randomInt( 0, canvas.width )
                b.Position.y = randomInt( 0, canvas.height )
                b.Velocity.x = randomNumber( -5, 5 )
                b.Velocity.y = randomNumber( -5, 5 )
                entityList.push( b )
            }
            console.log( { i: i } )

            requestAnimationFrame(updateGameStep)
        }
        window.addEventListener("load", InitializePage)

        window.bag.ctx = ctx
        window.bag = entityList // might go out of sync if re-assigned
        console.trace( 'debug enabled globals: ', { bag } )
        console.info( 'Using Context Attrs', ctx.getContextAttributes() )
    </script>
</body>

</html>